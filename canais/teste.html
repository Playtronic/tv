if (liveBtn) {
    liveBtn.addEventListener('click', function() {
        console.log('=== BOTÃO AO VIVO CLICADO ===');
        console.log('PROGRAMMING_MODE:', PROGRAMMING_MODE);
        
        // CALCULAR SLOT REAL ATUAL USANDO A FUNÇÃO CORRETA
        let slotRealAgora;
        
        if (PROGRAMMING_MODE === 'grade') {
            // Modo Grade: usar calcularSlotAtualGrade() que retorna base 1
            slotRealAgora = calcularSlotAtualGrade();
            console.log('Modo Grade - slotRealAgora:', slotRealAgora);
        } else {
            // Modo Playlist: usar calcularSlotAtualPlaylist() que já normaliza
            slotRealAgora = calcularSlotAtualPlaylist();
            console.log('Modo Playlist - slotRealAgora:', slotRealAgora);
        }
        
        console.log('currentPlayingSlot (atual):', currentPlayingSlot);
        console.log('slotRealAgora (calculado):', slotRealAgora);
        
        // COMPARAÇÃO DIRETA
        if (currentPlayingSlot !== slotRealAgora) {
            console.log('⚠️ DIFERENTE! Recarregando página.');
            console.log('currentPlayingSlot:', currentPlayingSlot, '!== slotRealAgora:', slotRealAgora);
            sessionStorage.setItem('aoVivoRecarregado', 'true');
            location.reload();
            return;
        }
        
        // SE FOR IGUAL: ajustar tempo do vídeo
        console.log('✅ IGUAL! Ajustando tempo do vídeo.');
        
        // Calcular percentual do slot
        const percentualSlot = calcularPercentualSlot();
        console.log('Percentual do slot:', (percentualSlot*100).toFixed(1) + '%');
        
        // Ajustar vídeo atual
        if (videoElement && videoElement.style.display !== 'none') {
            if (videoElement.readyState >= 1 && videoElement.duration > 0) {
                const novoTime = videoElement.duration * percentualSlot;
                videoElement.currentTime = Math.min(novoTime, videoElement.duration - 1);
                console.log('Vídeo ajustado para:', novoTime.toFixed(1), 'segundos');
                
                if (videoElement.paused) {
                    videoElement.play().catch(e => console.log('Erro ao dar play:', e));
                }
            }
        }
        
        showControls();
        resetControlsTimer();
    });
}
