<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monetiza√ß√£o - Gerador de TV Online</title>
    <link rel="icon" href="https://raw.githubusercontent.com/Playtronic/tv/refs/heads/main/template/favicon.png" type="image/png">
    
    <style>
        /* ESTILOS MANTIDOS IGUAIS - N√ÉO ALTEREI */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d); color: white; min-height: 100vh; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); border-radius: 15px; padding: 30px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3); }
        h1 { text-align: center; margin-bottom: 30px; font-size: 2.5rem; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3); }
        h3 { margin-bottom: 15px; color: #ffcc44; font-size: 1.5rem; }
        .monetization-option { background: rgba(255, 255, 255, 0.1); padding: 25px; border-radius: 10px; margin-bottom: 25px; border: 1px solid rgba(255, 255, 255, 0.2); }
        .control-option { display: flex; align-items: center; gap: 15px; margin-bottom: 15px; }
        .control-option input[type="checkbox"] { width: 20px; height: 20px; cursor: pointer; }
        .control-option label { font-size: 1.2rem; font-weight: bold; cursor: pointer; }
        .info-box { background: rgba(253, 187, 45, 0.1); padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #fdbb2d; }
        .info-box p { margin: 0; line-height: 1.6; }
        .form-group { margin: 20px 0; }
        label { display: block; margin-bottom: 8px; font-weight: bold; }
        input[type="url"], input[type="text"], input[type="number"], select { width: 100%; padding: 12px; border: none; border-radius: 8px; background: rgba(255, 255, 255, 0.9); font-size: 16px; color: #333; font-family: 'Segoe UI', sans-serif; }
        input:focus, select:focus { outline: none; box-shadow: 0 0 0 2px #fdbb2d; }
        .status-container { margin: 15px 0; padding: 15px; border-radius: 8px; }
        .status-connected { background: rgba(46, 204, 113, 0.2); border: 1px solid #2ecc71; }
        .status-disconnected { background: rgba(231, 76, 60, 0.2); border: 1px solid #e74c3c; }
        button { background: #fdbb2d; color: #000; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 16px; margin: 5px; transition: all 0.3s ease; }
        button:hover { background: #ffcc44; transform: translateY(-2px); }
        button:disabled { background: #6b7280; color: #9ca3af; cursor: not-allowed; opacity: 0.6; transform: none; }
        button:disabled:hover { background: #6b7280; transform: none; }
        .secondary { background: #4a5568; color: white; }
        .secondary:hover { background: #2d3748; }
        .disconnect-btn { background: #e74c3c !important; color: white !important; border: 2px solid white !important; padding: 10px 20px !important; font-size: 14px !important; }
        .disconnect-btn:hover { background: #c0392b !important; border-color: #c0392b !important; }
        .connect-button { background: linear-gradient(135deg, #009ee3, #0077b3); color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 16px; display: inline-flex; align-items: center; justify-content: center; gap: 10px; margin: 10px 0; transition: all 0.3s ease; }
        .connect-button:hover { background: linear-gradient(135deg, #0077b3, #005a8c); transform: translateY(-2px); }
        .mp-logo { width: 24px; height: 24px; object-fit: contain; }
        .navigation { display: flex; justify-content: space-between; margin-top: 40px; padding-top: 20px; border-top: 1px solid rgba(255, 255, 255, 0.2); }
        .loading { text-align: center; padding: 60px; font-size: 1.2rem; }
        .error-message { background: rgba(231, 76, 60, 0.2); border: 2px solid #e74c3c; padding: 15px; border-radius: 8px; margin-top: 20px; text-align: center; color: white; font-weight: bold; }
        .success-message { background: rgba(46, 204, 113, 0.2); border: 2px solid #2ecc71; padding: 15px; border-radius: 8px; margin-top: 20px; text-align: center; color: white; font-weight: bold; }
        .channel-header { display: flex; align-items: center; gap: 20px; margin-bottom: 30px; padding-bottom: 20px; border-bottom: 1px solid rgba(255, 255, 255, 0.2); }
        .channel-logo { width: 80px; height: 80px; border-radius: 10px; object-fit: cover; border: 2px solid #fdbb2d; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3); }
        .channel-info { flex: 1; }
        .channel-name { font-size: 1.8rem; margin-bottom: 5px; color: #fdbb2d; }
        .channel-slogan { font-size: 1rem; opacity: 0.9; font-style: italic; }
        .pix-info-card { background: rgba(46, 204, 113, 0.1); border: 2px solid rgba(46, 204, 113, 0.3); border-radius: 12px; padding: 20px; margin: 20px 0; }
        .pix-info-row { display: flex; justify-content: space-between; margin-bottom: 10px; padding-bottom: 10px; border-bottom: 1px solid rgba(255, 255, 255, 0.1); }
        .pix-info-label { font-weight: bold; color: #ddd; }
        .pix-info-value { color: #2ecc71; font-family: monospace; }
        @media (max-width: 768px) { .container { padding: 20px; } h1 { font-size: 2rem; } .monetization-option { padding: 20px; } .channel-header { flex-direction: column; text-align: center; gap: 15px; } .channel-logo { width: 100px; height: 100px; } .navigation { flex-direction: column; gap: 10px; } .navigation button { width: 100%; } .pix-info-row { flex-direction: column; gap: 5px; } }
    </style>
</head>
<body>
    <div class="container">
        <h1>Monetiza√ß√£o do Canal</h1>
        <div id="loading" class="loading">Carregando configura√ß√µes do canal...</div>

        <div id="content" style="display: none;">
            <div class="channel-header">
                <img id="channelLogo" class="channel-logo" src="" alt="Logo do Canal">
                <div class="channel-info">
                    <div class="channel-name" id="channelNameSpan"></div>
                    <div class="channel-slogan" id="channelSlogan"></div>
                </div>
            </div>

            <!-- Op√ß√£o 1: Adsterra -->
            <div class="monetization-option">
                <h3>1. Smartlink Adsterra</h3>
                <div class="control-option"><input type="checkbox" id="adsterraSmartlink"><label for="adsterraSmartlink">Habilitar Smartlink Adsterra</label></div>
                <div class="info-box"><p>Seus espectadores precisar√£o clicar em um bot√£o para desbloquear o conte√∫do, abrindo uma nova aba com an√∫ncio.</p></div>
                <div id="adsterraSettings" style="display: none; margin-top: 15px;">
                    <div class="form-group"><label for="adsterraSmartlinkUrl">URL do Smartlink Adsterra:</label><input type="url" id="adsterraSmartlinkUrl" placeholder="https://link.adsterra.com/sample"></div>
                </div>
            </div>

            <!-- Op√ß√£o 2: Doa√ß√µes PIX -->
            <div class="monetization-option">
                <h3>2. Doa√ß√µes via PIX</h3>
                <div class="info-box"><p>Seus espectadores podem fazer doa√ß√µes via PIX. Voc√™ recebe 92% do valor.</p></div>
                <div id="pixStatus" class="status-container status-disconnected"><div id="pixStatusMessage">‚ùå N√£o conectado ao Mercado Pago</div></div>
                <div class="control-option"><input type="checkbox" id="pixDonations"><label for="pixDonations">Habilitar doa√ß√µes via PIX</label></div>
                <div id="pixSettings" style="display: none; margin-top: 15px;">
                    <div id="pixInfoCard" class="pix-info-card" style="display: none;"><h4 style="color: #2ecc71; margin-bottom: 15px;">‚úÖ Conta Conectada</h4><div id="pixInfoContent"></div></div>
                    <div>
                        <button id="connectMpButton" class="connect-button"><img src="https://i.ibb.co/sv6xmVMG/mp.png" alt="Mercado Pago" class="mp-logo"> Conectar Mercado Pago</button>
                        <button id="disconnectMpButton" class="disconnect-btn" style="display: none;">Desconectar</button>
                    </div>
                </div>
            </div>

            <!-- Op√ß√£o 3: Comerciais Pagos -->
            <div class="monetization-option">
                <h3>3. Comerciais Pagos</h3>
                <div class="info-box"><p>Qualquer pessoa pode inserir um comercial no seu canal pagando por segundo.</p></div>
                <div id="commercialsMpStatus" class="status-container status-disconnected"><div id="commercialsMpStatusMessage">‚ùå N√£o conectado ao Mercado Pago</div></div>
                <div class="control-option"><input type="checkbox" id="paidCommercials"><label for="paidCommercials">Habilitar comerciais pagos</label></div>
                <div id="paidCommercialsSettings" style="display: none; margin-top: 15px;">
                    <div style="display: flex; gap: 20px; margin-bottom: 20px;">
                        <div><label for="pricePerSecond">Pre√ßo por segundo (R$):</label><input type="number" id="pricePerSecond" min="0.01" step="0.01" value="0.05" style="width: 150px;"></div>
                        <div><label for="maxCommercialDuration">Dura√ß√£o m√°xima (segundos):</label><input type="number" id="maxCommercialDuration" min="5" max="300" value="90" style="width: 150px;"></div>
                    </div>
                    <div>
                        <button id="connectMpCommercialsButton" class="connect-button"><img src="https://i.ibb.co/sv6xmVMG/mp.png" alt="Mercado Pago" class="mp-logo"> Conectar Mercado Pago</button>
                        <button id="disconnectMpCommercialsButton" class="disconnect-btn" style="display: none;">Desconectar</button>
                    </div>
                </div>
            </div>

            <!-- Navega√ß√£o -->
            <div class="navigation">
                <button id="cancelBtn" class="secondary">‚Üê Voltar para Gerador</button>
                <button id="saveBtn">Salvar e Publicar</button>
            </div>

            <!-- Mensagens -->
            <div id="errorMessage" class="error-message" style="display: none;"><div id="errorContent"></div><button onclick="hideError()" style="margin-top: 10px; background: #e74c3c; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;">Fechar</button></div>
            <div id="successMessage" class="success-message" style="display: none;"><div id="successContent"></div></div>
        </div>
    </div>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <script>
        // ==================== CONFIGURA√á√ÉO ====================
        const firebaseConfig = {
            apiKey: "AIzaSyAfD0QOlAVb50612u6siwCxzfZfGmgEB2E",
            authDomain: "playtronic-tv.firebaseapp.com",
            projectId: "playtronic-tv",
            storageBucket: "playtronic-tv.firebasestorage.app",
            messagingSenderId: "272337341020",
            appId: "1:272337341020:web:a30d949985fd614b5c7499",
            measurementId: "G-1QRKY0NN0W"
        };

        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }

        const auth = firebase.auth();
        const db = firebase.firestore();

        // ==================== VARI√ÅVEIS GLOBAIS ====================
        let currentUser = null;
        let channelId = null;
        let monetizationData = {
            adsterraSmartlink: { enabled: false, url: '' },
            pixDonations: { enabled: false, connected: false, isValid: false },
            paidCommercials: { enabled: false, pricePerSecond: 0.05, maxDuration: 90, connected: false, isValid: false }
        };

        // ==================== FUN√á√ïES PRINCIPAIS ====================
        function getUrlParameter(name) {
            return new URLSearchParams(window.location.search).get(name);
        }

        function connectToMercadoPago(type) {
            if (!channelId) {
                showError('ID do canal n√£o encontrado');
                return;
            }

            // CORRE√á√ÉO CR√çTICA: URL DE AUTENTICA√á√ÉO SIMPLES E CORRETA
            const CLIENT_ID = '4240568631810752';
            const REDIRECT_URI = 'https://us-central1-playtronic-tv.cloudfunctions.net/mercadoPagoCallback';
            
            // URL DO FLUXO OAuth do Mercado Pago - SIMPLES E DIRETA
            const authUrl = `https://auth.mercadopago.com/authorization?client_id=${CLIENT_ID}&response_type=code&platform_id=mp&redirect_uri=${encodeURIComponent(REDIRECT_URI)}&state=${channelId}_${type}`;
            
            console.log('üîó URL de autentica√ß√£o:', authUrl);
            
            // Abre a PORRA do popup DIRETO na p√°gina do Mercado Pago
            const popup = window.open(
                authUrl,
                'mercadoPagoAuth',
                'width=800,height=600,left=100,top=100,toolbar=no,location=yes,status=no,menubar=no,scrollbars=yes,resizable=yes'
            );
            
            if (!popup) {
                showError('O popup foi bloqueado. Permita popups para este site.');
                return;
            }
            
            popup.focus();
            
            // Verifica quando a janela fecha
            const checkPopup = setInterval(() => {
                if (popup.closed) {
                    clearInterval(checkPopup);
                    console.log('‚úÖ Popup fechado - verificando conex√£o...');
                    setTimeout(() => loadMonetizationData(), 3000);
                }
            }, 1000);
        }

        async function disconnectFromMercadoPago(type) {
            if (!confirm('Desconectar conta do Mercado Pago?')) return;
            
            try {
                const channelRef = db.collection('channels').doc(channelId);
                const updateData = { [type]: { connected: false, isValid: false } };
                
                await channelRef.collection('monetization').doc('settings').set(updateData, { merge: true });
                await loadMonetizationData();
                showSuccess('Conta desconectada!');
            } catch (error) {
                showError('Erro ao desconectar: ' + error.message);
            }
        }

        async function loadMonetizationData() {
            try {
                const channelRef = db.collection('channels').doc(channelId);
                const settingsDoc = await channelRef.collection('monetization').doc('settings').get();
                
                if (settingsDoc.exists) {
                    const data = settingsDoc.data();
                    if (data.adsterraSmartlink) monetizationData.adsterraSmartlink = data.adsterraSmartlink;
                    if (data.pixDonations) monetizationData.pixDonations = { ...monetizationData.pixDonations, ...data.pixDonations };
                    if (data.paidCommercials) monetizationData.paidCommercials = { ...monetizationData.paidCommercials, ...data.paidCommercials };
                }
                
                updateUI();
            } catch (error) {
                console.error('Erro ao carregar:', error);
            }
        }

        function updateUI() {
            // Adsterra
            document.getElementById('adsterraSmartlink').checked = monetizationData.adsterraSmartlink.enabled;
            document.getElementById('adsterraSmartlinkUrl').value = monetizationData.adsterraSmartlink.url || '';
            document.getElementById('adsterraSettings').style.display = monetizationData.adsterraSmartlink.enabled ? 'block' : 'none';

            // PIX
            document.getElementById('pixDonations').checked = monetizationData.pixDonations.enabled;
            document.getElementById('pixSettings').style.display = monetizationData.pixDonations.enabled ? 'block' : 'none';
            updatePixInterface();

            // Comerciais
            document.getElementById('paidCommercials').checked = monetizationData.paidCommercials.enabled;
            document.getElementById('pricePerSecond').value = monetizationData.paidCommercials.pricePerSecond;
            document.getElementById('maxCommercialDuration').value = monetizationData.paidCommercials.maxDuration;
            document.getElementById('paidCommercialsSettings').style.display = monetizationData.paidCommercials.enabled ? 'block' : 'none';
            updateCommercialsInterface();
        }

        function updatePixInterface() {
            const data = monetizationData.pixDonations;
            const statusDiv = document.getElementById('pixStatus');
            const statusMsg = document.getElementById('pixStatusMessage');
            const connectBtn = document.getElementById('connectMpButton');
            const disconnectBtn = document.getElementById('disconnectMpButton');
            const infoCard = document.getElementById('pixInfoCard');
            const infoContent = document.getElementById('pixInfoContent');

            if (data.connected && data.isValid) {
                statusDiv.className = 'status-container status-connected';
                statusMsg.innerHTML = '‚úÖ Conectado ao Mercado Pago';
                connectBtn.style.display = 'none';
                disconnectBtn.style.display = 'inline-block';
                
                if (data.pixKey) {
                    infoCard.style.display = 'block';
                    infoContent.innerHTML = `
                        <div class="pix-info-row"><span class="pix-info-label">Chave:</span><span class="pix-info-value">${data.pixKey}</span></div>
                        <div class="pix-info-row"><span class="pix-info-label">Tipo:</span><span class="pix-info-value">${data.pixKeyType || 'N√£o informado'}</span></div>
                        <div class="pix-info-row"><span class="pix-info-label">Titular:</span><span class="pix-info-value">${data.accountHolderName || 'N√£o informado'}</span></div>
                    `;
                }
            } else {
                statusDiv.className = 'status-container status-disconnected';
                statusMsg.innerHTML = '‚ùå N√£o conectado ao Mercado Pago';
                connectBtn.style.display = 'inline-block';
                disconnectBtn.style.display = 'none';
                infoCard.style.display = 'none';
            }
        }

        function updateCommercialsInterface() {
            const data = monetizationData.paidCommercials;
            const statusDiv = document.getElementById('commercialsMpStatus');
            const statusMsg = document.getElementById('commercialsMpStatusMessage');
            const connectBtn = document.getElementById('connectMpCommercialsButton');
            const disconnectBtn = document.getElementById('disconnectMpCommercialsButton');

            if (data.connected && data.isValid) {
                statusDiv.className = 'status-container status-connected';
                statusMsg.innerHTML = '‚úÖ Conectado ao Mercado Pago';
                connectBtn.style.display = 'none';
                disconnectBtn.style.display = 'inline-block';
            } else {
                statusDiv.className = 'status-container status-disconnected';
                statusMsg.innerHTML = '‚ùå N√£o conectado ao Mercado Pago';
                connectBtn.style.display = 'inline-block';
                disconnectBtn.style.display = 'none';
            }
        }

        async function loadChannelData() {
            try {
                if (!currentUser) throw new Error("Usu√°rio n√£o autenticado");
                
                channelId = getUrlParameter('channelId');
                if (!channelId) {
                    showError('ID do canal n√£o especificado');
                    setTimeout(() => window.location.href = 'https://canaisdetv.online/Gerador', 2000);
                    return;
                }

                // Carregar dados do canal
                let channelData = null;
                const channelRef = db.collection('channels').doc(channelId);
                const channelDoc = await channelRef.get();
                
                if (channelDoc.exists) {
                    channelData = channelDoc.data();
                } else {
                    // Tentar na estrutura antiga
                    const userChannelRef = db.collection('users').doc(currentUser.uid).collection('channels').doc(channelId);
                    const userChannelDoc = await userChannelRef.get();
                    if (userChannelDoc.exists) channelData = userChannelDoc.data();
                }

                // Atualizar UI
                if (channelData) {
                    document.getElementById('channelNameSpan').textContent = channelData.name || 'Canal sem nome';
                    document.getElementById('channelSlogan').textContent = channelData.slogan || '';
                    document.getElementById('channelLogo').src = channelData.logo || 'https://raw.githubusercontent.com/Playtronic/tv/refs/heads/main/template/logotv.png';
                }

                // Carregar monetiza√ß√£o
                await loadMonetizationData();

                // Verificar callback do MP
                const mpConnected = getUrlParameter('mpConnected');
                const mpType = getUrlParameter('type');
                const error = getUrlParameter('error');
                const errorMsg = getUrlParameter('message');

                if (mpConnected === 'success') {
                    showSuccess('‚úÖ Mercado Pago conectado com sucesso!');
                    // Limpar URL
                    window.history.replaceState({}, '', `?channelId=${channelId}`);
                    // Recarregar
                    setTimeout(() => loadMonetizationData(), 2000);
                }

                if (error) {
                    showError(`‚ùå Erro: ${decodeURIComponent(errorMsg || error)}`);
                    window.history.replaceState({}, '', `?channelId=${channelId}`);
                }

                // Mostrar conte√∫do
                document.getElementById('loading').style.display = 'none';
                document.getElementById('content').style.display = 'block';

            } catch (error) {
                console.error('Erro ao carregar canal:', error);
                showError(`Erro: ${error.message}`);
                setTimeout(() => window.location.href = 'https://canaisdetv.online/Gerador', 3000);
            }
        }

        async function saveMonetization() {
            try {
                // Atualizar dados
                monetizationData.adsterraSmartlink.enabled = document.getElementById('adsterraSmartlink').checked;
                monetizationData.adsterraSmartlink.url = document.getElementById('adsterraSmartlinkUrl').value.trim();
                monetizationData.pixDonations.enabled = document.getElementById('pixDonations').checked;
                monetizationData.paidCommercials.enabled = document.getElementById('paidCommercials').checked;
                monetizationData.paidCommercials.pricePerSecond = parseFloat(document.getElementById('pricePerSecond').value) || 0.05;
                monetizationData.paidCommercials.maxDuration = parseInt(document.getElementById('maxCommercialDuration').value) || 90;

                // Validar
                const errors = [];
                if (monetizationData.adsterraSmartlink.enabled && !monetizationData.adsterraSmartlink.url) {
                    errors.push('URL do Adsterra √© obrigat√≥ria');
                }
                if (monetizationData.pixDonations.enabled && !monetizationData.pixDonations.connected) {
                    errors.push('Conecte o Mercado Pago para doa√ß√µes PIX');
                }
                if (monetizationData.paidCommercials.enabled && !monetizationData.paidCommercials.connected) {
                    errors.push('Conecte o Mercado Pago para comerciais pagos');
                }
                
                if (errors.length > 0) {
                    showError('‚ùå Erros:<br>' + errors.join('<br>'));
                    return;
                }

                // Salvar
                const channelRef = db.collection('channels').doc(channelId);
                await channelRef.collection('monetization').doc('settings').set({
                    ...monetizationData,
                    lastUpdated: new Date()
                }, { merge: true });

                showSuccess('‚úÖ Configura√ß√µes salvas! Redirecionando...');
                setTimeout(() => {
                    window.location.href = `https://canaisdetv.online/Gerador?channelId=${channelId}&monetizationUpdated=true`;
                }, 2000);

            } catch (error) {
                showError(`Erro ao salvar: ${error.message}`);
            }
        }

        function showError(message) {
            const div = document.getElementById('errorMessage');
            const content = document.getElementById('errorContent');
            content.innerHTML = message;
            div.style.display = 'block';
            div.scrollIntoView({ behavior: 'smooth' });
        }

        function hideError() {
            document.getElementById('errorMessage').style.display = 'none';
        }

        function showSuccess(message) {
            const div = document.getElementById('successMessage');
            div.innerHTML = message;
            div.style.display = 'block';
            div.scrollIntoView({ behavior: 'smooth' });
            setTimeout(() => div.style.display = 'none', 3000);
        }

        // ==================== INICIALIZA√á√ÉO ====================
        document.addEventListener('DOMContentLoaded', function() {
            // Event listeners
            document.getElementById('connectMpButton').addEventListener('click', () => connectToMercadoPago('pixDonations'));
            document.getElementById('disconnectMpButton').addEventListener('click', () => disconnectFromMercadoPago('pixDonations'));
            document.getElementById('connectMpCommercialsButton').addEventListener('click', () => connectToMercadoPago('paidCommercials'));
            document.getElementById('disconnectMpCommercialsButton').addEventListener('click', () => disconnectFromMercadoPago('paidCommercials'));
            document.getElementById('saveBtn').addEventListener('click', saveMonetization);
            document.getElementById('cancelBtn').addEventListener('click', () => window.location.href = `https://canaisdetv.online/Gerador?channelId=${channelId || ''}`);

            // Checkboxes
            document.getElementById('adsterraSmartlink').addEventListener('change', function() {
                document.getElementById('adsterraSettings').style.display = this.checked ? 'block' : 'none';
            });
            document.getElementById('pixDonations').addEventListener('change', function() {
                document.getElementById('pixSettings').style.display = this.checked ? 'block' : 'none';
            });
            document.getElementById('paidCommercials').addEventListener('change', function() {
                document.getElementById('paidCommercialsSettings').style.display = this.checked ? 'block' : 'none';
            });

            // Autentica√ß√£o
            auth.onAuthStateChanged(async function(user) {
                currentUser = user;
                if (!user) {
                    showError('Sess√£o expirada. Redirecionando...');
                    setTimeout(() => window.location.href = 'https://canaisdetv.online/Gerador', 2000);
                    return;
                }
                await loadChannelData();
            });
        });
    </script>
</body>
</html>
